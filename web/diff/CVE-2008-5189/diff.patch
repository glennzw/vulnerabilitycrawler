commit 7282ed863ca7e6f928bae9162c9a63a98775a19d
Author: Michael Koziarski <michael@koziarski.com>
Date:   Tue Oct 14 11:47:27 2008 +0200

    Sanitize the URLs passed to redirect_to to prevent a potential response spli
    
    CGI.rb and mongrel don't do any sanitization of the contents of HTTP headers

diff --git a/actionpack/lib/action_controller/response.rb b/actionpack/lib/action_controller/response.rb
index 1d9f667..56dace0 100755
--- a/actionpack/lib/action_controller/response.rb
+++ b/actionpack/lib/action_controller/response.rb
@@ -30,9 +30,9 @@ module ActionController
 
     def redirect(to_url, response_status)
       self.headers["Status"] = response_status
-      self.headers["Location"] = to_url
+      self.headers["Location"] = to_url.gsub(/[\r\n]/, '')
 
-      self.body = "<html><body>You are being <a href=\"#{to_url}\">redirected</a>.</body></html>"
+      self.body = "<html><body>You are being <a href=\"#{CGI.escapeHTML(to_url)}\">redirected</a>.</body></html>"
     end
 
     def prepare!
