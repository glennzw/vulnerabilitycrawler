   Relevant BUGIDs:
   
   Purpose of commit: bugfix
   
   Commit summary:
   ---------------
   2010-09-27  Dmitry V. Levin  <ldv@altlinux.org>
   
   	* modules/pam_xauth/pam_xauth.c (check_acl): Check that the given
   	access control file is a regular file.
2010-09-16  Dmitry V. Levin  <ldv@altlinux.org>

	* modules/pam_env/pam_env.c (handle_env): Use setfsuid() return code.
#include <sys/types.h>
#include <sys/fsuid.h>
#include <sys/wait.h>
#include <errno.h>
#include <fnmatch.h>
#include <grp.h>
{
	char path[PATH_MAX];
	struct passwd *pwd;
	FILE *fp;
	int i, save_errno;
	uid_t fsuid;
	/* Check this user's <sense> file. */
	pwd = pam_modutil_getpwnam(pamh, this_user);
	if (pwd == NULL) {
		return PAM_SESSION_ERR;
	}
	fsuid = setfsuid(pwd->pw_uid);
	fp = fopen(path, "r");
	save_errno = errno;
	setfsuid(fsuid);
	if (fp != NULL) {
		char buf[LINE_MAX], *tmp;
		/* Scan the file for a list of specs of users to "trust". */
		while (fgets(buf, sizeof(buf), fp) != NULL) {
