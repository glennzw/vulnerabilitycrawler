   decode_entities confused by trailing incomplete entity
   
   Mark Martinec reported crashed when running SpamAssassin, given a
   particular HTML junk mail to parse.  The problem was caused by
   HTML::Parsers decode_entities function confusing itself when it
   encountered strings with incomplete entities at the end of the string.
use HTML::Entities qw(decode_entities encode_entities encode_entities_numeric);

use Test::More tests => 16;

$a = "V&aring;re norske tegn b&oslash;r &#230res";

is(decode_entities("&apos;"), "'");
is(encode_entities("'", "'"), "&#39;");


__END__
# Quoted from rfc1866.txt
	ent_start = s;
	repl = 0;

	if (*s == '#') {
	    UV num = 0;
	    UV prev = 0;
	    int ok = 0;
	    s++;
	    if (*s == 'x' || *s == 'X') {
		s++;
		while (*s) {
		    char *tmp = strchr(PL_hexdigit, *s);
		    if (!tmp)
			break;
		}
	    }
	    else {
		while (isDIGIT(*s)) {
		    num = num * 10 + (*s - '0');
		    if (prev && num < prev) {
			/* overflow */
	}
	else {
	    char *ent_name = s;
	    while (isALNUM(*s))
		s++;
	    if (ent_name != s && entity2char) {
		SV** svp;

	if (repl) {
	    char *repl_allocated = 0;
	    if (*s == ';')
		s++;
	    t--;  /* '&' already copied, undo it */

