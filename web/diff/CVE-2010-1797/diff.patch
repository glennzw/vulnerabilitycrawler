commit 11d65e8a1f1f14e56148fd991965424d9bd1cdbc
Author: Suzuki, Toshiya (鈴木俊哉) <mpsuzuki@hiroshima-u.ac.jp>
Date:   Wed Aug 4 14:43:29 2010 +0200

    [cff] Improve stack overflow test.
    
    * src/cff/cffgload.c (cff_decoder_parse_charstrings): Check stack
    after execution of operations too.

diff --git a/ChangeLog b/ChangeLog
index 54c49b0..07cb466 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,10 @@
+2010-08-04  Suzuki, Toshiya (鈴木俊哉) <mpsuzuki@hiroshima-u.ac.jp>
+
+	[cff] Improve stack overflow test.
+
+	* src/cff/cffgload.c (cff_decoder_parse_charstrings): Check stack
+	after execution of operations too.
+
 2010-07-18  Werner Lemberg  <wl@gnu.org>
 
 	Add reference counters and to FT_Library and FT_Face objects.
diff --git a/src/cff/cffgload.c b/src/cff/cffgload.c
index 347041c..887c879 100644
--- a/src/cff/cffgload.c
+++ b/src/cff/cffgload.c
@@ -2455,7 +2455,10 @@
           return CFF_Err_Unimplemented_Feature;
         }
 
-      decoder->top = args;
+        decoder->top = args;
+
+        if ( decoder->top - stack >= CFF_MAX_OPERANDS )
+          goto Stack_Overflow;
 
       } /* general operator processing */
 
