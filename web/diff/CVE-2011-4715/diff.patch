commit 8ea6f7bc37d05a9ec25b5afbea011cf9de5f1e49
Author: Clay Fouts <cfouts@liblime.com>
Date:   Fri Nov 25 00:06:23 2011 -0800

    [#21464023] Security: arbitrary file inclusion
    
    Poor input cleansing can allow a well-constructed cookie
    to return the contents of arbitrary file system objects.

diff --git a/C4/Output.pm b/C4/Output.pm
index e72c5e1..155c5c4 100644
--- a/C4/Output.pm
+++ b/C4/Output.pm
@@ -143,6 +143,7 @@ sub themelanguage {
       if $http_accept_language;
     # But, if there's a cookie set, obey it
     $lang = $query->cookie('KohaOpacLanguage') if $query->cookie('KohaOpacLanguage');
+    $lang =~ s/[^\p{IsAlnum}\-_]//g;
     # Fall back to English
     my @languages;
     if ($interface eq 'intranet') {
