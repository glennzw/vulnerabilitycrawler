commit e82ef4545e9e98cbcb032f55d7c750b81e3a0450
Author: Nikos Mavrogiannopoulos <nmav@gnutls.org>
Date:   Tue Nov 8 07:52:56 2011 +0100

    bug fix in gnutls_session_get_data().

diff --git a/lib/gnutls_session.c b/lib/gnutls_session.c
index 418a2ba..fd012fe 100644
--- a/lib/gnutls_session.c
+++ b/lib/gnutls_session.c
@@ -48,31 +48,32 @@ int
 gnutls_session_get_data (gnutls_session_t session,
                          void *session_data, size_t * session_data_size)
 {
 
   gnutls_datum_t psession;
   int ret;
 
   if (session->internals.resumable == RESUME_FALSE)
     return GNUTLS_E_INVALID_SESSION;
 
   psession.data = session_data;
 
   ret = _gnutls_session_pack (session, &psession);
   if (ret < 0)
     {
       gnutls_assert ();
       return ret;
     }
 
   if (psession.size > *session_data_size)
     {
+      *session_data_size = psession.size;
       ret = GNUTLS_E_SHORT_MEMORY_BUFFER;
       goto error;
     }
   *session_data_size = psession.size;
 
   if (session_data != NULL)
     memcpy (session_data, psession.data, psession.size);
 
   ret = 0;
 
