commit 662c3110803bd8c1aedacc36788e6fd028944314
Author: Kay Sievers <kay.sievers@vrfy.org>
Date:   Wed Apr 8 06:06:01 2009 -0700

    path_encode: fix max length calculation
    
    Sebastian Krahmer wrote:
    > it should reserve 4 times not 3 times len :)

diff --git a/udev/lib/libudev-util.c b/udev/lib/libudev-util.c
index b628fdd..a40be06 100644
--- a/udev/lib/libudev-util.c
+++ b/udev/lib/libudev-util.c
@@ -103,26 +103,26 @@ int util_log_priority(const char *priority)
 
 size_t util_path_encode(char *s, size_t len)
 {
-	char t[(len * 3)+1];
+	char t[(len * 4)+1];
 	size_t i, j;
 
 	for (i = 0, j = 0; s[i] != '\0'; i++) {
 		if (s[i] == '/') {
 			memcpy(&t[j], "\\x2f", 4);
 			j += 4;
 		} else if (s[i] == '\\') {
 			memcpy(&t[j], "\\x5c", 4);
 			j += 4;
 		} else {
 			t[j] = s[i];
 			j++;
 		}
 	}
 	if (len == 0)
 		return j;
 	i = (j < len - 1) ? j : len - 1;
 	memcpy(s, t, i);
 	s[i] = '\0';
 	return j;
 }
 
