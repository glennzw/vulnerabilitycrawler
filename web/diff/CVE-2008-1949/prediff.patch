   Fix GNUTLS-SA-2008-1 security vulnerabilities.
   See http://www.gnu.org/software/gnutls/security.html for updates.
	  len = _gnutls_read_uint16 (p);
	  p += 2;

	  DECR_LENGTH_RET (data_size, len, 0);
	  server_names++;

	  p += len;
	}

      session->security_parameters.extensions.server_names_size =
      if (server_names == 0)
	return 0;		/* no names found */

      /* we cannot accept more server names.
       */
      if (server_names > MAX_SERVER_NAME_EXTENSIONS)
	server_names = MAX_SERVER_NAME_EXTENSIONS;

      p = data + 2;
      for (i = 0; i < server_names; i++)
      return GNUTLS_E_INTERNAL_ERROR;
    }


  /* actual decryption (inplace)
   */

      pad = ciphertext.data[ciphertext.size - 1] + 1;	/* pad */

      length = ciphertext.size - hash_size - pad;

      if (pad > ciphertext.size - hash_size)
	{
	  gnutls_assert ();
	  /* We do not fail here. We check below for the
	  pad_failed = GNUTLS_E_DECRYPTION_FAILED;
	}

      /* Check the pading bytes (TLS 1.x)
       */
      if (ver >= GNUTLS_TLS1 && pad_failed == 0)

      *recv_type = session->internals.handshake_header_buffer.recv_type;

      return session->internals.handshake_header_buffer.packet_length;
    }

