commit 3af54c9bd9e6f14f896aac1bb0e8405ae0bc7a44
Author: Vasiliy Kulikov <segooon@gmail.com>
Date:   Sat Oct 30 18:22:49 2010 +0400

    ipc: shm: fix information leak to userland
    
    The shmid_ds structure is copied to userland with shm_unused{,2,3}
    fields unitialized.  It leads to leaking of contents of kernel stack
    memory.
    
    Signed-off-by: Vasiliy Kulikov <segooon@gmail.com>
    Acked-by: Al Viro <viro@ZenIV.linux.org.uk>
    Cc: stable@kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/ipc/shm.c b/ipc/shm.c
index fd658a1..7d3bb22 100644
--- a/ipc/shm.c
+++ b/ipc/shm.c
@@ -473,25 +473,26 @@ SYSCALL_DEFINE3(shmget, key_t, key, size_t, size, int, shmflg)
 static inline unsigned long copy_shmid_to_user(void __user *buf, struct shmid64_ds *in, int version)
 {
 	switch(version) {
 	case IPC_64:
 		return copy_to_user(buf, in, sizeof(*in));
 	case IPC_OLD:
 	    {
 		struct shmid_ds out;
 
+		memset(&out, 0, sizeof(out));
 		ipc64_perm_to_ipc_perm(&in->shm_perm, &out.shm_perm);
 		out.shm_segsz	= in->shm_segsz;
 		out.shm_atime	= in->shm_atime;
 		out.shm_dtime	= in->shm_dtime;
 		out.shm_ctime	= in->shm_ctime;
 		out.shm_cpid	= in->shm_cpid;
 		out.shm_lpid	= in->shm_lpid;
 		out.shm_nattch	= in->shm_nattch;
 
 		return copy_to_user(buf, &out, sizeof(out));
 	    }
 	default:
 		return -EINVAL;
 	}
 }
 
