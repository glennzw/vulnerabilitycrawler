commit 34b349675af9f72eb822837a8772cc1ead7115c7
Author: Aleksey Sanin <aleksey@aleksey.com>
Date:   Mon Jun 15 10:45:36 2009 -0700

    Fixed HMAC vuln with small values of HMAC length

diff --git a/ChangeLog b/ChangeLog
index e6d53f3..1377f92 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,210 +1,213 @@
 2009-06-15  Aleksey Sanin  <aleksey@aleksey.com>
 	* configure.in docs/download.html docs/index.html docs/news.html 
 	include/xmlsec/version.h: preparation for new 1.2.12 release
 
+2009-06-15  Aleksey Sanin  <aleksey@aleksey.com>
+	* fixed HMAC vuln with small values of HMAC length 
+
 2009-06-13  Aleksey Sanin  <aleksey@aleksey.com>
         * fixing gnutls detection (bug #585629)
 
 2009-06-09  Aleksey Sanin  <aleksey@aleksey.com>
         * update SVN to GIT references in docs
 
 2009-06-09  Aleksey Sanin  <aleksey@aleksey.com>
         * adding configurable Base64 line length
 
 2008-09-10  Aleksey Sanin  <aleksey@aleksey.com>
 	* fixing bug #501315 (patch from Antony Dovgal)
 
 2008-08-26  Aleksey Sanin  <aleksey@aleksey.com>
 	* apps/xmlsec.c: fix integer division (patch from Mikhail)
 
 2008-06-10  Aleksey Sanin  <aleksey@aleksey.com>
 	* src/mscrypto/x509.c src/openssl/x509.c src/nss/x509.c: fix crash
 	in the error reporting (based on patch from Frank Gross)
 
 2008-06-04  Aleksey Sanin  <aleksey@aleksey.com>
 	* src/templates.c src/keyinfo.c src/xmltree.c src/mscrypto/x509.c 
         src/openssl/x509.c src/nss/x509.c include/xmlsec/xmltree.h:
 	added new function xmlSecNodeEncodeAndSetContent for encoding
 	special chars in the node content (bug reported by Cliff Hones)
 
 2008-06-04  Aleksey Sanin  <aleksey@aleksey.com>
 	* src/xmltree.c, src/xmlenc.c, include/xmlsec/xmltree.h, include/xmlsec/xmlenc.h: 
 	add an option to return the replaced (encrypted) node(s) to the caller
 	(based on the patch from Frank Gross)
 
 2008-05-23  Aleksey Sanin  <aleksey@aleksey.com>
 	
 	* src/mscrypto/app.c: fix MS certificates ref counting
 
 2007-11-06  Aleksey Sanin  <aleksey@aleksey.com>
 	
 	* configure.in docs/download.html docs/index.html docs/news.html 
 	include/xmlsec/version.h: preparation for new 1.2.11 release
 
 2007-07-19  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* bug #454397 - mingw build: added missing files
 
 2007-07-19  Aleksey Sanin  <aleksey@aleksey.com>
 
         * bug #454397 - mingw build: normal way to pass def file to linker
         (patch from Roumen Petrov)
 
 2007-07-17  Aleksey Sanin  <aleksey@aleksey.com>
 
         * bug #454397 - mingw build: (cross-compilation) and several 
         minor cleanups (patch from Roumen Petrov)
 
 2007-06-16  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in: configure fixes (patch from Roumen Petrov)
 
 2007-06-06  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/mscrypto/*: better support for non micorsoft CSP's (patch from 
 	Wouter and Ed Shallow)
 
 2007-02-12  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* Makefile.am xmlsec1.m4: automake macro for xmlsec1 (from Heiko Ronsdorf)
 
 2006-09-04  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* include/xmlsec/openssl/app.h src/openssl/app.c src/openssl/x509vfy.c:
 	added xmlSecOpenSSLAppKeysMngrAddCertsFile() function 
 	(David Norrel)
 
 2006-08-15  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/openssl/x509vfy.c: fixed loading certs from a directory
 	during openssl x509 store init (based on idea from David Norrel)
 
 2006-06-12  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* include/xmlsec/templates.h, src/templates.c, src/xmltree.c:
 	support for custom namespaces prefixes for xmldisg namespace
 	(based on patch from Barry Ferg)
 
 2006-06-12  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in docs/download.html docs/index.html docs/news.html 
 	include/xmlsec/version.h: preparation for new 1.2.10 release
 
 2006-06-12  Aleksey Sanin  <aleksey@aleksey.com>
 	
 	* xmlsec-config.in: lib64/ folder patch from Daniel
 
 2006-06-08  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* config.h.in configure.in xmlsec-nss.pc.in: support different
 	packages for NSPR/NSS 
 
 2006-05-20  Aleksey Sanin  <aleksey@aleksey.com>
 	Added xmlSecOpenSSLX509StoreAdoptCrl() function
 
 2006-03-10  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/nss/app.c, src/openssl/x509vfy.c, src/xmldsig.c,
 	src/xmlsec-ltdl.c, src/xmlsec-ltdl.patch: cleanup Coverity
 	complaints
 
 2006-02-26  Aleksey Sanin  <aleksey@aleksey.com>
 	* apps/xmlsec.c tests/testDSig.sh: added an ability to skip
 	tests for transforms not available in given built
 	* tests/: added GOST test from Dmitry Belyavsky
 
 2006-02-16  Aleksey Sanin  <aleksey@aleksey.com>
 	* src/mscrypto/certkeys.c: fixed memleak in msrypto
 
 2006-02-14  Aleksey Sanin  <aleksey@aleksey.com>
 	* include/xmlsec/mscrypto/x509.h src/mscrypto/x509vfy.h:
 	added an option for disabling system trusted certs
 	for mscrypto store (based on patch from Dmitry Belyavsky)
 
 2006-02-10  Aleksey Sanin  <aleksey@aleksey.com>
 	* authors docs/authors.html
 	include/xmlsec/app.h include/xmlsec/private.h 
 	include/xmlsec/strings.h include/xmlsec/mscrypto/crypto.h
 	include/xmlsec/mscrypto/symbols.h src/app.c src/dl.c
 	src/strings.c src/transforms.c src/mscrypto/certkeys.c
 	src/mscrypto/crypto.c src/mscrypto/digests.c
 	src/mscrypto/signatures.c src/skeleton/crypto.c:
 	added support for GOST94 for digests and 
 	GOST 2001 keys/signatures: mscrypto only (patch from 
 	Dmitry Belyavsky)
 
 2005-12-20  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/mscrypto/x509vfy.c: check MSCrypto store for certs
 	(patch from Dmitry Belyavsky); replace tabs with spaces
 
 2005-12-15  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* include/xmlsec/templates.h src/templates.c: functions
 	for adding X509IssuerName and X509SerialNumber nodes
 	to the template (patch from Dmitry Belyavsky)
 
 2005-11-14  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in: fixing shrext vs. shrext_cmds conflict
 
 2005-09-25  Aleksey Sanin  <aleksey@aleksey.com>
 	* src/nss/pkikeys.c: fixing xmlsec-nss crash
 	* configure.in: change crypto libs order to be openssl/nss/gnutls
 
 2005-07-12  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in docs/download.html docs/index.html docs/news.html:
 	preparation for new 1.2.9 release 
 
 2005-07-12  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/xmltree.c: fixing a problem with namespaces in the
 	nodes created by "template" functions
 
 2005-07-10  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* src/openssl/evp.c: added hack from Erwann ABALEA: 
 	OpenSSL ENGINE keys are always private since we can't query
 	engine and do real check
 
 2005-07-10  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* docs/* include/* src/* tests/*: added support for 
 	RSA-MD5/RIPEMD160/SHA224/SHA256/SHA384/SHA512 for OpenSSL 0.9.8
 
 2005-07-10  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in docs/ include/ src/ tests/: implemented
 	SHA224/256/384/512, HMAC-SHA224/256/384/512, MD5 for OpenSSL 0.9.8
 
 2005-07-10  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in docs/xmldsig.html docs/xmlenc.html
 	include/xmlsec/app.h include/xmlsec/private.h include/xmlsec/strings.h
 	include/xmlsec/openssl/crypto.h include/xmlsec/openssl/symbols.h
 	src/app.c src/dl.c src/strings.c: preparations for SHA224/256/384/512
 	and friends
 
 2005-07-09  Aleksey Sanin  <aleksey@aleksey.com>
 
 	* configure.in tests/aleksey-xmldsig-01/* tests/keys/* 
 	tests/merlin-xmldsig-twenty-three/signature.tmpl 
 	tests/testDSig.sh: updating test certificates for picky
 	OpenSSL 0.9.8
 	
 
 2005-07-08  Aleksey Sanin  <aleksey@aleksey.com>
 	* configure.in src/openssl/x509vfy.c: initial support 
 	for OpenSSL 0.9.8
 
 2005-05-12  Aleksey Sanin  <aleksey@aleksey.com>
 	
 	* src/openssl/app.c: fixed "disable-x509" build option 
 	(patch from Bernd Becker)
 
 2005-05-11  Aleksey Sanin  <aleksey@aleksey.com>
 	
 	* src/openssl/signatures.c: fixed "disable-dsa" build option 
 	(patch from Bernd Becker)
 
diff --git a/docs/download.html b/docs/download.html
index c953247..6ce4215 100644
--- a/docs/download.html
+++ b/docs/download.html
@@ -1,113 +1,109 @@
 <html>
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <title>XML Security Library: Download</title>
 </head>
 <body><table witdh="100%" valign="top"><tr valign="top">
 <td valign="top" align="left" width="210">
 <img src="images/logo.gif" alt="XML Security Library" border="0"><p></p>
 <ul>
 <li><a href="index.html">Home</a></li>
 <li><a href="download.html">Download</a></li>
 <li><a href="news.html">News</a></li>
 <li><a href="documentation.html">Documentation</a></li>
 <ul>
 <li><a href="faq.html">FAQ</a></li>
 <li><a href="api/xmlsec-notes.html">Tutorial</a></li>
 <li><a href="api/xmlsec-reference.html">API reference</a></li>
 <li><a href="api/xmlsec-examples.html">Examples</a></li>
 </ul>
 <li><a href="xmldsig.html">XML Digital Signature</a></li>
 <ul><li><a href="http://www.aleksey.com/xmlsec/xmldsig-verifier.html">Online Verifier</a></li></ul>
 <li><a href="xmlenc.html">XML Encryption</a></li>
 <li><a href="c14n.html">XML Canonicalization</a></li>
 <li><a href="bugs.html">Reporting Bugs</a></li>
 <li><a href="http://www.aleksey.com/pipermail/xmlsec">Mailing list</a></li>
 <li><a href="related.html">Related</a></li>
 <li><a href="authors.html">Authors</a></li>
 </ul>
 <table width="100%">
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/"><img src="images/libxml2-logo.png" alt="LibXML2" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/XSLT"><img src="images/libxslt-logo.png" alt="LibXSLT" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://www.openssl.org/"><img src="images/openssl-logo.png" alt="OpenSSL" border="0"></a></td>
 </tr>
 <!--Links - start--><!--Links - end-->
 </table>
 </td>
 <td valign="top"><table width="100%" valign="top"><tr><td valign="top" align="left" id="xmlsecContent">
 <div align="Center">       
       <h1>Download</h1>
       </div>
 <h2>Stable releases.</h2>
 <p>The latest stable XML Security Library version is <b>1.2.12</b>:</p>
 <ul>
 <li>
         <a href="http://www.aleksey.com/xmlsec/download/xmlsec1-1.2.12.tar.gz">Sources 
-	for latest version</a> 
-	(<a href="ftp://ftp.xmlsoft.org/xmlsec/releases">XMLSoft.org</a> mirrors).
-    </li>
-    <li>Fedora 7 RPM 
-    	<a href="http://www.aleksey.com/xmlsec/download/">xmlsec1 packages</a>.
+	for latest version</a>.
     </li>
     <li>
 	<a href="http://www.zlatkovic.com/projects/libxml/index.html">Windows 
 	binaries</a> for XMLSec Library (as well as LibXML2, LibXSLT and OpenSSL)
 	from <a href="mailto:igor@zlatkovic.com">Igor Zlatkovic</a>.
     </li>
     <li>XMLSec Library is included as part of Debian GNU/Linux. For more 
 	information see the <a href="http://memebeam.org/toys/DebianXmlsec">coordination page</a>. 
     </li>
     <li>XMLSec Library <a href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/security/xmlsec/">FreeBSD</a>
 	and <a href="http://www.openbsd.org/cgi-bin/cvsweb/ports/security/xmlsec/">OpenBSD</a>
 	ports.	
     </li>
 </ul>
 <p>The <a href="ftp://ftp.aleksey.com/pub/xmlsec/releases/">previous releases</a> are also available.</p>
 <h2>Requirements</h2>
 <p>
     The XML Security Library requires:
     </p>
 <ul>
 <li><a href="http://xmlsoft.org/downloads.html">LibXML</a></li>
     <li>
 <a href="http://xmlsoft.org/XSLT/downloads.html">LibXSLT</a> (optional)</li>
 </ul>
 <p>and one of the following cryptographic libraries:</p>
 <ul>
 <li>
 <a href="http://www.openssl.org/">OpenSSL</a> version 0.9.8 
 	(it also should work with 0.9.7 and 0.9.6 but some features 
 	would be disabled).
         </li>
 	<li>
 <a href="http://www.gnu.org/software/gnutls/">GnuTLS</a>
 	and <a href="http://www.gnu.org/directory/security/libgcrypt.html">Libgcrypt</a> - 
 	GNU SSL and cryptographic libraries.
 	</li>
         <li>
 <a href="http://www.mozilla.org/projects/security/pki/nss/">NSS</a> -
 	Mozilla cryptographic library.
 	</li>
     </ul>
 <h2>Installation (source archive)</h2>
 <p>
       All steps are usual:<br></p>
 <blockquote>
 <code>gunzip -c xmlsec1-xxx.tar.gz | tar xvf -</code><br><code>cd xmlsec1-xxxx</code><br><code>./configure --help</code><br><code>./configure [possible options] </code><br><code>make</code><br><code>make install</code><br><code>make check</code>
 </blockquote>
 <p>
        The last step is optional and requires Internet connection to execute
        some tests.<br></p>
 <h2>GIT</h2>
 <p>XML Security Library is available from the 
 <a href="http://live.gnome.org/Git/Developers">Gnome GIT</a>
 (the module name is <b>xmlsec</b>). The online XMLSec 
 <a href="http://git.gnome.org/cgit/xmlsec">source browser</a>
diff --git a/docs/index.html b/docs/index.html
index fd89ad0..953ac5d 100644
--- a/docs/index.html
+++ b/docs/index.html
@@ -1,151 +1,115 @@
 <html>
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <title>XML Security Library</title>
 </head>
 <body><table witdh="100%" valign="top"><tr valign="top">
 <td valign="top" align="left" width="210">
 <img src="images/logo.gif" alt="XML Security Library" border="0"><p></p>
 <ul>
 <li><a href="index.html">Home</a></li>
 <li><a href="download.html">Download</a></li>
 <li><a href="news.html">News</a></li>
 <li><a href="documentation.html">Documentation</a></li>
 <ul>
 <li><a href="faq.html">FAQ</a></li>
 <li><a href="api/xmlsec-notes.html">Tutorial</a></li>
 <li><a href="api/xmlsec-reference.html">API reference</a></li>
 <li><a href="api/xmlsec-examples.html">Examples</a></li>
 </ul>
 <li><a href="xmldsig.html">XML Digital Signature</a></li>
 <ul><li><a href="http://www.aleksey.com/xmlsec/xmldsig-verifier.html">Online Verifier</a></li></ul>
 <li><a href="xmlenc.html">XML Encryption</a></li>
 <li><a href="c14n.html">XML Canonicalization</a></li>
 <li><a href="bugs.html">Reporting Bugs</a></li>
 <li><a href="http://www.aleksey.com/pipermail/xmlsec">Mailing list</a></li>
 <li><a href="related.html">Related</a></li>
 <li><a href="authors.html">Authors</a></li>
 </ul>
 <table width="100%">
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/"><img src="images/libxml2-logo.png" alt="LibXML2" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/XSLT"><img src="images/libxslt-logo.png" alt="LibXSLT" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://www.openssl.org/"><img src="images/openssl-logo.png" alt="OpenSSL" border="0"></a></td>
 </tr>
 <!--Links - start--><!--Links - end-->
 </table>
 </td>
 <td valign="top"><table width="100%" valign="top"><tr><td valign="top" align="left" id="xmlsecContent">
 <div align="Center">                                          
       <h1>XML Security Library</h1>
             </div>
 <p>
              XML Security Library is a C library based on 
 	     <a href="http://xmlsoft.org/">LibXML2</a>.
       The library  supports major XML security standards:                                        	    
       </p>
 <ul>
 <li>
 <a href="http://www.w3.org/TR/xmldsig-core">XML Signature</a>
  	     </li>
 	     <li>
 <a href="http://www.w3.org/TR/xmlenc-core/">XML Encryption</a>
 	     </li>
               <li>
 <a href="http://www.w3.org/TR/xml-c14n">Canonical XML</a>
  	     (was included in <a href="http://xmlsoft.org">LibXML2</a>)</li>
               <li>
 <a href="http://www.w3.org/TR/xml-exc-c14n">Exclusive Canonical XML</a>
  	     (was included in <a href="http://xmlsoft.org">LibXML2</a>)</li>
                                             	    
       </ul>
 <p>
              XML Security Library is released under the  	    
 	     <a href="http://www.opensource.org/licenses/mit-license.html">MIT  Licence</a>
      	    see the Copyright file in the distribution  for details.<br><br></p>
 <p><b>News</b></p>
 <ul>
 <li>July 14 2009<br>
 	The new <a href="download.html">XML Security Library 1.2.12</a> release
 	includes the following changes (see ChangeLog for the complete list of changes):
 	<ul>	
+	<li>Fixed HMAC vulnerability with small values of HMAC length.</li>
 	<li>Added an option to return the replaced (based on the patch from Frank Gross)</li>
 	<li>Added new function xmlSecNodeEncodeAndSetContent for encoding
 	special chars in the node content.</li>
 	<li>Added configurable Base64 line length.</li>
 	<li>Bug fixes.</li>
 	</ul>
 </li>
 <li>November 6 2007<br>
 	The new <a href="download.html">XML Security Library 1.2.11</a> release
 	includes the following changes:
 	<ul>
 <li>Mingw port (Roumen Petrov).</li>
 	<li>Better support for non micorsoft CSP's (Wouter and Ed Shallow).</li>
 	<li>Bug fixes.</li>
 	</ul>
 </li>
 <li>June 12 2006<br>
 	The new <a href="download.html">XML Security Library 1.2.10</a> release
 	includes the following changes:
 	<ul>
 <li>GOST algorithms support (Dmitry Belyavsky)</li>
 	<li>Ability to disable system trusted certs in xmlsec-mscrypto 
 	(Dmitry Belyavsky)</li>
 	<li>New functions for adding X509IssuerName and X509SerialNumber 
 	nodes to the template (Dmitry Belyavsky)
 	</li>
 <li>Better packaging support for Fedora and Debian (Daniel Veillard, John Belmonte)</li>
 	<li>Cleanups from Coverity tool reports</li>
 	<li>Bug fixes</li>
 	</ul>
 </li>
-<br><li>July 12 2005<br>
-	The new <a href="download.html">XML Security Library 1.2.9</a> release
-	includes few bug fixes and adds support for the recently released 
-	<a href="http://www.openssl.org">OpenSSL 0.9.8</a> including several 
-	new algorithms for <a href="xmldsig.html">xmlsec-openssl</a>:
-	<ul>
-<li>SHA224/SHA256/SHA384/SHA512</li>
-	    <li>HMAC-SHA224/SHA256/SHA384/SHA512</li>
-	    <li>RSA-MD5/RIPEMD160/SHA224/SHA256/SHA384/SHA512</li>
-	</ul>
-</li>
-<br><li>March 30 2005<br>
-	The new <a href="download.html">XML Security Library 1.2.8</a> release
-	merges OpenOffice.org changes to xmlsec-mscrypto and xmlsec-nss into
-	main xmlsec source tree.
-</li>
-<br><li>February 23 2005<br>
-	The new <a href="download.html">XML Security Library 1.2.7</a> release
-	includes several bug fixes and minor enchancements:
-	<ul>
-<li>(core) added xmlSecSimpleKeysStoreGetKeys() function;</li>
-	<li>(core) added functions to create &lt;X509Data/&gt; node children
-	     in the signature template;</li>
-	<li>(core) fixed xmlSecGenerateID() function;</li>
-	<li>(core) fixed dynamic linking initialization/shutdown when custom memory 
-	    allocation functions are used;</li>
-	<li>(core) fixed encrypted text parsing and xmlParseInNodeContext() function;</li>
-	<li>(openssl) fixed parsing quoted values in the certificate subject;</li>
-	<li>(mscrypto) negative numbers support in xmlSecBnFromString()/xmlSecBnToString() functions.</li>
-	</ul>
-</li>
-
-<br><li>August 25 2004<br>
-	The new <a href="download.html">XML Security Library 1.2.6</a> 
-	fixes several minor bugs and adds support for loading keys and
-	certificates from memory.
-</li>
 
 </ul>
 </td></tr></table></td>
 </tr></table></body>
 </html>
diff --git a/docs/news.html b/docs/news.html
index 3677071..5c77903 100644
--- a/docs/news.html
+++ b/docs/news.html
@@ -1,446 +1,447 @@
 <html>
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <title>XML Security Library: News</title>
 </head>
 <body><table witdh="100%" valign="top"><tr valign="top">
 <td valign="top" align="left" width="210">
 <img src="images/logo.gif" alt="XML Security Library" border="0"><p></p>
 <ul>
 <li><a href="index.html">Home</a></li>
 <li><a href="download.html">Download</a></li>
 <li><a href="news.html">News</a></li>
 <li><a href="documentation.html">Documentation</a></li>
 <ul>
 <li><a href="faq.html">FAQ</a></li>
 <li><a href="api/xmlsec-notes.html">Tutorial</a></li>
 <li><a href="api/xmlsec-reference.html">API reference</a></li>
 <li><a href="api/xmlsec-examples.html">Examples</a></li>
 </ul>
 <li><a href="xmldsig.html">XML Digital Signature</a></li>
 <ul><li><a href="http://www.aleksey.com/xmlsec/xmldsig-verifier.html">Online Verifier</a></li></ul>
 <li><a href="xmlenc.html">XML Encryption</a></li>
 <li><a href="c14n.html">XML Canonicalization</a></li>
 <li><a href="bugs.html">Reporting Bugs</a></li>
 <li><a href="http://www.aleksey.com/pipermail/xmlsec">Mailing list</a></li>
 <li><a href="related.html">Related</a></li>
 <li><a href="authors.html">Authors</a></li>
 </ul>
 <table width="100%">
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/"><img src="images/libxml2-logo.png" alt="LibXML2" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://xmlsoft.org/XSLT"><img src="images/libxslt-logo.png" alt="LibXSLT" border="0"></a></td>
 </tr>
 <tr>
 <td width="15"></td>
 <td><a href="http://www.openssl.org/"><img src="images/openssl-logo.png" alt="OpenSSL" border="0"></a></td>
 </tr>
 <!--Links - start--><!--Links - end-->
 </table>
 </td>
 <td valign="top"><table width="100%" valign="top"><tr><td valign="top" align="left" id="xmlsecContent">
 <div align="Center">                                   
       <h1>XML Security Library News</h1>
       </div>
 <ul>
 <li>July 14 2009<br>
 	The new <a href="download.html">XML Security Library 1.2.12</a> release
 	includes the following changes (see ChangeLog for the complete list of changes):
 	<ul>	
+	<li>Fixed HMAC vulnerability with small values of HMAC length.</li>
 	<li>Added an option to return the replaced (based on the patch from Frank Gross)</li>
 	<li>Added new function xmlSecNodeEncodeAndSetContent for encoding
 	special chars in the node content.</li>
 	<li>Added configurable Base64 line length.</li>
 	<li>Bug fixes.</li>
 	</ul>
 </li>
 <li>November 6 2007<br>
 	The new <a href="download.html">XML Security Library 1.2.11</a> release
 	includes the following changes:
 	<ul>
 <li>Mingw port (Roumen Petrov).</li>
 	<li>Better support for non micorsoft CSP's (Wouter and Ed Shallow).</li>
 	<li>Bug fixes.</li>
 	</ul>
 </li>
 <br><li>June 12 2006<br>
 	The new <a href="download.html">XML Security Library 1.2.10</a> release
 	includes the following changes:
 	<ul>
 <li>GOST algorithms support (Dmitry Belyavsky)</li>
 	<li>Ability to disable system trusted certs in xmlsec-mscrypto 
 	(Dmitry Belyavsky)</li>
 	<li>New functions for adding X509IssuerName and X509SerialNumber 
 	nodes to the template (Dmitry Belyavsky)
 	</li>
 <li>Better packaging support for Fedora and Debian (Daniel Veillard, John Belmonte)</li>
 	<li>Cleanups from Coverity tool reports</li>
 	<li>Bug fixes</li>
 	</ul>
 </li>
 <br><li>July 12 2005<br>
 	The new <a href="download.html">XML Security Library 1.2.9</a> release
 	includes few bug fixes and adds support for the recently released 
 	<a href="http://www.openssl.org">OpenSSL 0.9.8</a> including several 
 	new algorithms for <a href="xmldsig.html">xmlsec-openssl</a>:
 	<ul>
 <li>SHA224/SHA256/SHA384/SHA512</li>
 	    <li>HMAC-SHA224/SHA256/SHA384/SHA512</li>
 	    <li>RSA-MD5/RIPEMD160/SHA224/SHA256/SHA384/SHA512</li>
 	</ul>
 </li>
 <br><li>March 30 2005<br>
 	The new <a href="download.html">XML Security Library 1.2.8</a> release
 	merges OpenOffice.org changes to xmlsec-mscrypto and xmlsec-nss into
 	main xmlsec source tree.
 </li>
 <br><li>February 23 2005<br>
 	The new <a href="download.html">XML Security Library 1.2.7</a> release
 	includes several bug fixes and minor enchancements:
 	<ul>
 <li>(core) added xmlSecSimpleKeysStoreGetKeys() function;</li>
 	<li>(core) added functions to create &lt;X509Data/&gt; node children
 	     in the signature template;</li>
 	<li>(core) fixed xmlSecGenerateID() function;</li>
 	<li>(core) fixed dynamic linking initialization/shutdown when custom memory 
 	    allocation functions are used;</li>
 	<li>(core) fixed encrypted text parsing and xmlParseInNodeContext() function;</li>
 	<li>(openssl) fixed parsing quoted values in the certificate subject;</li>
 	<li>(mscrypto) negative numbers support in xmlSecBnFromString()/xmlSecBnToString() functions.</li>
 	</ul>
 </li>
 
 <br><li>August 25 2004<br>
 	The new <a href="download.html">XML Security Library 1.2.6</a> 
 	fixes several minor bugs and adds support for loading keys and
 	certificates from memory.
 </li>
 
 <br><li>July 27 2004<br>
 	Created a <a href="related.html#books">list of books</a> about
 	cryptography and security that covers most of the topics needed
 	for using XML Security Library.
 </li>
 
 <br><li>April 15 2004<br>
 	The new <a href="download.html">XML Security Library 1.2.5</a> 
 	includes a simple XKMS server implementation and fixes a nasty
 	bug with encrypting/decrypting nodes with an empty content.
 </li>
 
 <br><li>January 27 2004<br>
 	The new <a href="download.html">XML Security Library 1.2.4</a> 
 	release fixes many configuration and installation problems 
 	found by John.
 </li>
 
 <br><li>January 6 2004<br>
 	The new <a href="download.html">XML Security Library 1.2.3</a> 
 	release upgrades xmlsec-gnutls code to support latest gnutls
 	library version (1.0.4) and fixes several configuration and 
 	installation problems.
 </li>
 
 <br><li>November 11 2003<br>
 	The new <a href="download.html">XML Security Library 1.2.2</a> 
 	release includes several improvements in ./configure script
 	(Daniel, Roumen) and a bug fix for certificates serial number
 	processing in xmlsec-mscrypto.
 </li>
 
 <br><li>October 14 2003<br>
 	The new <a href="download.html">XML Security Library 1.2.1</a> 
 	release includes a special "hack" for supporting ID attributes
 	with invalid values in Visa 3D; fixed processing of root element 
 	node siblings (bug #124245); template functions for creating 
 	&lt;enc:KeyReference/&gt; and &lt;enc:DataReference/&amp;gt
         nodes (Wouter); new "XMLSEC_DOCDIR" environment variable 
 	for ./configure script; updated README files for xmlsec-crypto
 	libraries.
 </li>
 
 <br><li>September 30 2003<br>
 	The major change in the new <a href="download.html">XML Security Library 1.2.0</a> 
 	release is the MS Crypto API support implemented by Wouter. Other changes
 	include loading public keys from certificates and improved namespaces 
 	support for start node selection with "--node-xpath" command line option
 	for xmlsec command line utility; updated online XML DSig Verifier;
 	updated docs and man pages.
 </li>
 
 <br><li>September 17 2003<br>
 	The new <a href="download.html">XML Security Library 1.1.2</a> release
 	introduces dynamical crypto engines loading based on ltdl library (including
 	tutorial, API reference and documentation updates); adds an ability to build 
 	multiple xmlsec-crypto libraries in one build on Windows; fixes minor problems
 	in test suite and multiple warnings when building on Sun Solaris.
 </li>
 
 <br><li>August 21 2003<br>
 	The new <a href="download.html">XML Security Library 1.1.1</a> release
 	adds &lt;X509Data/&gt; node templates support to xmlsec-nss (Tej);
 	includes new functions for reading keys and certificates from memory 
 	for xmlsec-core and xmlsec-openssl (Joachim); fixes several problems
 	in xmlsec configuration files (Roumen) and a bug in URI attribute 
 	XInclude processing.
 </li>
 
 <br><li>August 5 2003<br>
 	A great patch from Tej that dramaticaly improves xmlsec-nss functionality
 	deserves a minor version number update :). In addition to that, the new 
 	<a href="download.html">XML Security Library 1.1.0</a> 
 	release includes &lt;X509Data/&gt; node templates support
 	for xmlsec-openssl (Roumen); separate pkg-config files for xmlsec-crypto
 	libraries and minor documentation updates (including coding style
 	and some useful commands for xmlsec developers in a new "HACKING" 
 	file).
 </li>
 
 <br><li>July 15 2003<br>
 	There were several minor patches during last month and it's time to do 
 	a new <a href="download.html">XML Security Library 1.0.4</a> 
 	release to pick up them: x509 certificates names comparison function
 	now supports multiple entries woth the same object name (Roumen); 
 	multiple build fixes; documentation mistypes fixes.<br>
 	Also I gave an XML Security presentation at 
 	<a href="http://oreillynet.com/oscon2003/">OSCON 2003</a> last week. 
 	You can download slides <a href="http://www.aleksey.com/xmlsec/extra/xmlsec_oscon_2003.ppt">here</a>.
 </li>
 
 <br><li>June 17 2003<br>
 	The <a href="download.html">XML Security Library 1.0.3</a> 
 	release adds PKCS#8 support for xmlsec-openssl (Tej) and fixes several 
 	configuration and portability problems.
 </li>
 <br><li>June 03 2003<br>
 	The <a href="download.html">XML Security Library 1.0.2</a> 
 	release includes several fixes in xmlsec-nss configuration and
 	linking options (Tej), PKCS21 files reading improvements,
 	minor documentation and help file fixes. Also this release
 	includes some code for XKMS support. This is absolutely not usable
 	right now and not configured in by default. Please, don't
 	use or even compile it in.
 </li>
 <br><li>April 28 2003<br>
 	The <a href="download.html">XML Security Library 1.0.1</a> 
 	release is a maintanance release. It fixes several compilation 
 	problems found in 1.0.0 release on the following platforms: 
 	OpenBSD/sparc64, Win32 Wacom C, Sun Workshop CC 6.0. Also from 
 	now on Win32 MSVC port enables the threading support 
 	by default (this is a part of the Igor's change to 
 	LibXML2/LibXSLT/XMLSec libraries).If you don't
 	use one of these platforms then you'll see no difference.
 </li>
 <br><li>April 17 2003<br>
 	The <a href="download.html">XML Security Library 1.0.0</a> 
 	release is the major upgrade from 0.0.X version.
 	The new version includes multiple crypto engines support
 	(with "out of the box" support for OpenSSL, GnuTLS and NSS);
 	simplified and cleaned internal structure and API; 
 	several performance and memory usage improvements;
 	new or updated documentation (tutorial, API reference manual and 
 	examples).
 </li>
 <br><li>April 10 2003<br>
 	The final release candidate <a href="download.html">XML Security 
 	Library 1.0.0rc1</a> is available for download. This release includes 
 	minor API polishing, 
 	complete <a href="api/xmlsec-ref.html">API Reference Manual</a>, 
 	new chapters in the <a href="api/xmlsec-notes.html">tutorial</a> and 
 	several new <a href="api/xmlsec-examples.html">examples</a>.
 	Another big change is using major version number in library files
 	to prevent collisions between different library versions.<br>
 	If no major problems will be found then the 1.0.0 release should
 	happen in a week from now.
 	</li>
 <br><li>April 8 2003<br>
 	The new <a href="download.html">XML Security Library 0.0.15</a> 
 	release is a preparation for the upcomming 1.0.0 release and
 	provides an ability to have both versions installed together 
 	on the same box. 
 	Also this release includes updated expired certificates for 
 	the regression test suite and a fix for minor bug in reading binary 
 	keys on Windows.
 	</li>
 <br><li>April 6 2003<br><table><tr>
 <td>
 	<a href="http://conferences.oreilly.com/oscon/"><img border="0" src="http://conferences.oreillynet.com/images/os2003/banners/130x40.gif" alt="O'Reilly Open Source Convent3Dion"></a>	
 	</td>
 <td width="10"></td>
 <td valign="top">It seems that I'll be giving a 
 	<a href="http://conferences.oreillynet.com/cs/os2003/view/e_sess/3838">presentation</a>
 	at the <a href="http://conferences.oreilly.com/oscon/">O'Reilly Open Source Convention 2003</a>
 	about XML Security and XML Security Library. Stop by to say "Hello!".
 	</td>
 </tr></table>
 </li>
 
 <br><li>March 26 2003<br><a href="download.html">XML Security Library 0.1.1</a>
 	release is the first release candidate for the new stable 
 	version of XML Security Library. A lot of internal changes 
 	including enchanced processing controls, performance improvements
 	for XML transforms, <a href="api/index.html">new documentation</a>,
 	updated <a href="api/xmlsec-examples.html">examples</a>
 	and many many other small things.<br>
 	Please try this release and report bugs. Again, it's the first
 	release candidate and it's very important for me to get your
 	feedback about it. Also if you are missing some features
 	in the library it's the best time to ask!
 	</li>
 <br><li>March 19 2003<br><a href="download.html">XML Security Library 0.0.14</a> release
 	includes several minor bugfixes in references URI
 	processing, binary transforms processing and xmlsec 
 	command line utility.
 	</li>
 <br><li>March 5 2003<br>
 	The <a href="download.html">XML Security Library 0.1.0</a> release
 	creates a framework for integrating XML Security Library
 	with almost any crypto engine and even combining multiple crypto
 	engines in one application. As an example, basic support for GnuTLS and NSS 
 	libraries is provided (digests, hmac and block ciphers).<br>
 	This is a pre-alpha release <b>not recommended</b> for production
 	(please use the <a href="download.html">stable 0.0.X</a> releases 
 	instead). The new 0.1.X API and ABI will defenetly change.
 	However, if you plan to use XML Security Library with a new crypto
 	engine and plan to write some code then you can start now. 
 	The "backend" API is pretty stable and I do not expect major
 	changes. 
 	</li>
 <br><li>February 21 2003<br><a href="download.html">XML Security Library 0.0.13</a> release
 	fixes incorrect processing of signatures with more than 3 binary 
 	transforms in a row, improved pkcs12 files support and minor
 	documentation update.
 	</li>
 <br><li>January 26 2003<br>
 	Two major fixes in <a href="http://www.aleksey.com/pipermail/xmlsec/2003/000507.html">HMAC</a> and 
 	<a href="http://www.aleksey.com/pipermail/xmlsec/2003/000516.html">DES/AES</a> 
 	algorithms are the reason for the new <a href="download.html">XML Security Library 0.0.12</a> release.
 	Also there are few other minor features and bug fixes (see Changelog in the 
 	distribution for more details).
 	</li>
 <br><li>December 3 2002<br>
 	New <a href="download.html">XML Security Library 0.0.11</a> release
 	fixes a <a href="http://www.aleksey.com/pipermail/xmlsec/2002/000368.html">major 
 	problem</a> in Reference URI attribute processing. This release
 	also includes several Win32 build process fixes from Igor.	
 	</li>
 <br><li>October 20 2002<br>
 	Almost two months from previous release and a lot of minor 
 	enchancements are good reasons for the new
 	<a href="download.html">XML Security Library 0.0.10</a> release:<br>
 	- added a way to specify "current time" to verify certificates
 	expiration against it;<br>
 	- implemented XML results output format for the xmlsec command
 	line utility;<br>
 	- fixed XMLDSig examples and added a new one (thanks to Devin 
 	Heitmueller);<br>
 	- resolved static link issue and a bunch of other improvements 
 	for Win32 platform builds (Igor Zlatkovic);<br>
 	- added dynamic linking option for xmlsec command line utility
 	to help Debian port (John Belmonte);<br>
 	- minor bug fixes.
 	</li>
 <br><li>August 26 2002<br>
 	I've completelly screwed up. The release 0.0.8 was totally broken 
 	(I've simply packaged files from wrong CVS :) )
 	and I am doing a new <a href="download.html">0.0.9 release</a>
 	to fix all the problems. Please upgrade to the new version 
 	if you use any of previous XML Security Library releases.<br>
 	I am really sorry for my stupid mistakes and I promise to never 
 	do releases on Friday :( <br>
 	And special thanks to Ferrell Moultrie for pointing this out.	
 	</li>
 <br><li>August 23 2002<br><a href="download.html">XML Security Library 0.0.8</a> is released:<br>
 	- New errors reporting system is created and all the code is updated;<br>
 	- Added XPointer transform support;<br>
 	- Major enveloped and XPath transforms performance improvements;<br>
 	- Updated XPath 2 Filter implementation to reflect latest W3C specifications;<br>
 	- <a href="xmlsec-man.html">Man page</a> for xmlsec utility is written;<br>
 	- Automatically generated <a href="documentation.html">API Reference 
 	Manual</a> (more than 370 symbols) is created;<br> 
 	- Minor Win32 bug fixes from Igor;<br>
 	- Debian port from John Belmonte.<br>
 </li>
 <br><li>July 11 2002<br>
 	XML Security Library <a href="documentation.html">documentation</a> 
 	created.
 	</li>
 <br><li>July 10 2002<br>
 	A new <a href="download.html">XML Security Library 0.0.7</a> release
 	includes all small bug fixes for last month and a new LibXML2 library
 	with improved canonicalization.
 	</li>
 <br><li>May 28 2002<br> 
 	New LibXML 2.4.22 is <a href="http://xmlsoft.org/news.html">released</a>
 	and new <a href="download.html">XML Security Library 0.0.6</a> is 
 	released:<br>
 	- Win32 port is added: the idea and most of the configuration scripts
 	code was taken from LibXML2 (written by Igor Zlatkovic). I modified
 	original files so all errors are mine, not Igor's.<br>
 	- Many different performance optimizations (especially for RSA/DSA
 	algorithms and enveloped signatures).<br>
 	- <a href="http://www.w3.org/TR/xmldsig-filter2/">XPath Filter 2</a>
 	and <a href="http://lists.w3.org/Archives/Public/w3c-ietf-xmldsig/2002AprJun/0001.html">Alternative 
 	XPath Filter</a> (not compiled by default, use --enable-altxpath configuration
 	switch if you need this transform) support is added. <br>
 	- Custom network protocol handler support is added. It is similar
 	to custom protocol handlers in LibXML2 but applied to binary files.<br>
 	- Separated XML Security Library RPM into xmlsec and xmlsec-devel
 	(suggested by Devin Heitmueller).<br>
 </li>
 	<br><li>May 14 2002<br>
 	I've checked in new code for plugging in custom input handlers
 	(similar to ones that exist in LibXML2). The downside is that
 	you have to use <a href="ftp://xmlsoft.org/cvs-snapshot.tar.gz">daily 
 	LibXML2 snapshot</a> to compile daily XML Security Library snapshot.
 	</li>
 	<br><li>April 28 2002<br><a href="download.html">XMLSec 0.0.5</a> released: <br>
         - Big external and internal cleanup. Now the API looks much more consistent
 	and I hope simple. I hope to declare API frozen in the next couple weeks.
 	Meantime, all comments and suggestions are welcome!<br>
 	- Added <a href="http://www.w3.org/TR/xmlenc-core/#sec-Alg-SymmetricKeyWrap">
 	symmetric key wrap</a> (aes, des) support.<br>
 	- Added RIPEMD-160 support.<br>
 </li>
 	<br><li>April 19 2002<br>
 	 Minor release <a href="download.html">XMLSec 0.0.4</a> with main
 	 goal to fix broken RPM:<br>
 	 - The RPM is recompiled using OpenSSL 0.9.6. The previous 
 	 version was compiled with OpenSSL 0.9.7 but I got few complains
 	 that there are no RPMs for 0.9.7 yet. The downsides of using 0.9.6 are
 	 some functionality limitations for XML Encryption (no AES support,
 	 incorrect padding mode for DES, etc.). If you want to use
 	 XML Encryption it is better to compile the library from sources
 	 and use OpenSSL 0.9.7<br>
 	 - The testDSig, testEnc and testKeys scripts merged into standalone
 	 "xmlsec" application.<br>
 	 - A couple minor bugs fixed.<br>
 </li>
 	<br><li>April 17 2002<br>
 	Installed <a href="http://www.aleksey.com/pipermail/xmlsec">
 	xmlsec mailing list.</a><br>
 </li>
 	<br><li>April 16 2002<br>
 	 A lot of changes and time for new release <a href="download.html">XMLSec 0.0.3</a>:<br>
 	 - The first release that includes <a href="xmlenc.html">XML Encryption support</a>! 
 	 The bad news is that most of new features require <a href="download.html">OpenSSL 0.9.7</a> which is 
 	 not officially released yet.<br>
 	 - Options to enable/disable support for particular algorithms were
 	 added to the <code>./configure</code> script.<br>
 	 - All transforms header files were consolidated in transforms.h
          <br>
 </li>
 	 <br><li>April 6 2002<br>
 	 The <a href="download.html">RPM packages</a> are now available.<br><br>
 </li>
           <li>April 5 2002<br>
  Test suite updates and new minor release <a href="download.html">XML Security Library 0.0.2a.</a>
           <br>
  New <a href="http://lists.w3.org/Archives/Public/w3c-ietf-xmldsig/2002AprJun/0017.html">
  interoperability tests</a>
   were provided by Merlin Hughes. XML Security Library successfully passed 
           <b>all tests </b>after small test program tweaking and adding workaround 
diff --git a/include/xmlsec/gnutls/crypto.h b/include/xmlsec/gnutls/crypto.h
index dd80436..f7fbbad 100644
--- a/include/xmlsec/gnutls/crypto.h
+++ b/include/xmlsec/gnutls/crypto.h
@@ -105,18 +105,22 @@ XMLSEC_CRYPTO_EXPORT int		xmlSecGnuTLSKeyDataDesSet	(xmlSecKeyDataPtr data,
 XMLSEC_CRYPTO_EXPORT xmlSecTransformId xmlSecGnuTLSTransformDes3CbcGetKlass(void);
 
 #endif /* XMLSEC_NO_DES */
 
 
 /********************************************************************
  *
  * HMAC transforms
  *
  *******************************************************************/
 #ifndef XMLSEC_NO_HMAC
+
+XMLSEC_CRYPTO_EXPORT int               xmlSecGnuTLSHmacGetMinOutputLength();
+XMLSEC_CRYPTO_EXPORT void              xmlSecGnuTLSHmacSetMinOutputLength(int min_length);
+
 /** 
  * xmlSecGnuTLSKeyDataHmacId:
  * 
  * The HMAC key klass.
  */
 #define xmlSecGnuTLSKeyDataHmacId \
 	xmlSecGnuTLSKeyDataHmacGetKlass()
diff --git a/include/xmlsec/nss/crypto.h b/include/xmlsec/nss/crypto.h
index f1cd44e..381ee1f 100644
--- a/include/xmlsec/nss/crypto.h
+++ b/include/xmlsec/nss/crypto.h
@@ -183,18 +183,22 @@ XMLSEC_CRYPTO_EXPORT xmlSecKeyDataId 	xmlSecNssKeyDataDsaGetKlass	(void);
 XMLSEC_CRYPTO_EXPORT xmlSecTransformId xmlSecNssTransformDsaSha1GetKlass(void);
 
 #endif /* XMLSEC_NO_DSA */
 
 
 /********************************************************************
  *
  * HMAC transforms
  *
  *******************************************************************/
 #ifndef XMLSEC_NO_HMAC
+
+XMLSEC_CRYPTO_EXPORT int               xmlSecNssHmacGetMinOutputLength();
+XMLSEC_CRYPTO_EXPORT void              xmlSecNssHmacSetMinOutputLength(int min_length);
+
 /** 
  * xmlSecNssKeyDataHmacId:
  * 
  * The DHMAC key data klass.
  */
 #define xmlSecNssKeyDataHmacId \
 	xmlSecNssKeyDataHmacGetKlass()
diff --git a/include/xmlsec/openssl/crypto.h b/include/xmlsec/openssl/crypto.h
index 2274e35..3b50b40 100644
--- a/include/xmlsec/openssl/crypto.h
+++ b/include/xmlsec/openssl/crypto.h
@@ -192,18 +192,22 @@ XMLSEC_CRYPTO_EXPORT EVP_PKEY*		xmlSecOpenSSLKeyDataDsaGetEvp	(xmlSecKeyDataPtr
 XMLSEC_CRYPTO_EXPORT xmlSecTransformId xmlSecOpenSSLTransformDsaSha1GetKlass(void);
 #endif /* XMLSEC_NO_SHA1 */
 
 #endif /* XMLSEC_NO_DSA */
 
 /********************************************************************
  *
  * HMAC transforms
  *
  *******************************************************************/
 #ifndef XMLSEC_NO_HMAC
+
+XMLSEC_CRYPTO_EXPORT int               xmlSecOpenSSLHmacGetMinOutputLength();
+XMLSEC_CRYPTO_EXPORT void              xmlSecOpenSSLHmacSetMinOutputLength(int min_length);
+
 /** 
  * xmlSecOpenSSLKeyDataHmacId:
  * 
  * The DHMAC key klass.
  */
 #define xmlSecOpenSSLKeyDataHmacId \
 	xmlSecOpenSSLKeyDataHmacGetKlass()
diff --git a/src/gnutls/hmac.c b/src/gnutls/hmac.c
index 1119110..5a0940c 100644
--- a/src/gnutls/hmac.c
+++ b/src/gnutls/hmac.c
@@ -1,32 +1,62 @@
 /** 
  * XMLSec library
  *
  * This is free software; see Copyright file in the source
  * distribution for preciese wording.
  * 
  * Copyright (C) 2002-2003 Aleksey Sanin <aleksey@aleksey.com>
  */
 #ifndef XMLSEC_NO_HMAC
 #include "globals.h"
 
 #include <string.h>
 
 #include <gnutls/gnutls.h>
 #include <gcrypt.h>
 
 #include <xmlsec/xmlsec.h>
 #include <xmlsec/xmltree.h>
 #include <xmlsec/keys.h>
 #include <xmlsec/transforms.h>
 #include <xmlsec/errors.h>
 
 #include <xmlsec/gnutls/app.h>
 #include <xmlsec/gnutls/crypto.h>
 
+#define XMLSEC_GNUTLS_MIN_HMAC_SIZE		64
 #define XMLSEC_GNUTLS_MAX_HMAC_SIZE		128
 
 /**************************************************************************
  *
+ * Configuration
+ *
+ *****************************************************************************/
+static int g_xmlsec_gnutls_hmac_min_length = XMLSEC_GNUTLS_MIN_HMAC_SIZE;
+
+/**
+ * xmlSecGnuTLSHmacGetMinOutputLength: 
+ * 
+ * Returns the min HMAC output length
+ */
+int xmlSecGnuTLSHmacGetMinOutputLength()
+{
+    return g_xmlsec_gnutls_hmac_min_length;
+}
+
+/**
+ * xmlSecGnuTLSHmacSetMinOutputLength: 
+ *
+ * @min_length: the new min length 
+ * 
+ * Sets the min HMAC output length
+ */
+void xmlSecGnuTLSHmacSetMinOutputLength(int min_length)
+{
+    g_xmlsec_gnutls_hmac_min_length = min_length;
+}
+
+/**************************************************************************
+ *
  * Internal GNUTLS HMAC CTX
  *
  *****************************************************************************/
@@ -160,37 +190,50 @@ static int
 xmlSecGnuTLSHmacNodeRead(xmlSecTransformPtr transform, xmlNodePtr node, xmlSecTransformCtxPtr transformCtx) {
     xmlSecGnuTLSHmacCtxPtr ctx;
     xmlNodePtr cur;
 
     xmlSecAssert2(xmlSecGnuTLSHmacCheckId(transform), -1);
     xmlSecAssert2(xmlSecTransformCheckSize(transform, xmlSecGnuTLSHmacSize), -1);
     xmlSecAssert2(node != NULL, -1);
     xmlSecAssert2(transformCtx != NULL, -1);
 
     ctx = xmlSecGnuTLSHmacGetCtx(transform);
     xmlSecAssert2(ctx != NULL, -1);
 
     cur = xmlSecGetNextElementNode(node->children); 
     if((cur != NULL) && xmlSecCheckNodeName(cur, xmlSecNodeHMACOutputLength, xmlSecDSigNs)) {  
 	xmlChar *content;
 	
 	content = xmlNodeGetContent(cur);
 	if(content != NULL) {
 	    ctx->dgstSize = atoi((char*)content);	    
 	    xmlFree(content);
 	}
-	/* todo: error if dgstSize == 0 ?*/
+	
+	/* Ensure that HMAC length is greater than min specified.
+	   Otherwise, an attacker can set this lenght to 0 or very 
+	   small value
+	*/
+	if(ctx->dgstSize < xmlSecGnuTLSHmacGetMinOutputLength()) {
+ 	   xmlSecError(XMLSEC_ERRORS_HERE,
+		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
+		    xmlSecNodeHMACOutputLength,
+		    XMLSEC_ERRORS_R_INVALID_NODE_ATTRIBUTE,
+		    "HMAC output length is too small");
+	   return(-1);
+	}
+
 	cur = xmlSecGetNextElementNode(cur->next);
     }
     
     if(cur != NULL) {
 	xmlSecError(XMLSEC_ERRORS_HERE,
 		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
 		    xmlSecNodeGetName(cur),
 		    XMLSEC_ERRORS_R_INVALID_NODE,
 		    "no nodes expected");
 	return(-1);
     }
     return(0); 
 }
 
 
diff --git a/src/nss/hmac.c b/src/nss/hmac.c
index f67ec9d..a7c2018 100644
--- a/src/nss/hmac.c
+++ b/src/nss/hmac.c
@@ -1,35 +1,65 @@
 /** 
  * XMLSec library
  *
  * This is free software; see Copyright file in the source
  * distribution for preciese wording.
  * 
  * Copyright (C) 2002-2003 Aleksey Sanin <aleksey@aleksey.com>
  * Copyright (c) 2003 America Online, Inc.  All rights reserved.
  */
 #ifndef XMLSEC_NO_HMAC
 #include "globals.h"
 
 #include <string.h>
 
 #include <nspr.h>
 #include <nss.h>
 #include <secoid.h>
 #include <pk11func.h>
 
 #include <xmlsec/xmlsec.h>
 #include <xmlsec/xmltree.h>
 #include <xmlsec/keys.h>
 #include <xmlsec/transforms.h>
 #include <xmlsec/errors.h>
 
 #include <xmlsec/nss/app.h>
 #include <xmlsec/nss/crypto.h>
 
+#define XMLSEC_NSS_MIN_HMAC_SIZE		64
 #define XMLSEC_NSS_MAX_HMAC_SIZE		128
 
 /**************************************************************************
  *
+ * Configuration
+ *
+ *****************************************************************************/
+static int g_xmlsec_nss_hmac_min_length = XMLSEC_NSS_MIN_HMAC_SIZE;
+
+/**
+ * xmlSecNssHmacGetMinOutputLength: 
+ * 
+ * Returns the min HMAC output length
+ */
+int xmlSecNssHmacGetMinOutputLength()
+{
+    return g_xmlsec_nss_hmac_min_length;
+}
+
+/**
+ * xmlSecNssHmacSetMinOutputLength: 
+ *
+ * @min_length: the new min length 
+ * 
+ * Sets the min HMAC output length
+ */
+void xmlSecNssHmacSetMinOutputLength(int min_length)
+{
+    g_xmlsec_nss_hmac_min_length = min_length;
+}
+
+/**************************************************************************
+ *
  * Internal NSS HMAC CTX
  *
  *****************************************************************************/
@@ -144,37 +174,50 @@ static int
 xmlSecNssHmacNodeRead(xmlSecTransformPtr transform, xmlNodePtr node, xmlSecTransformCtxPtr transformCtx) {
     xmlSecNssHmacCtxPtr ctx;
     xmlNodePtr cur;
 
     xmlSecAssert2(xmlSecNssHmacCheckId(transform), -1);
     xmlSecAssert2(xmlSecTransformCheckSize(transform, xmlSecNssHmacSize), -1);
     xmlSecAssert2(node!= NULL, -1);
     xmlSecAssert2(transformCtx!= NULL, -1);
 
     ctx = xmlSecNssHmacGetCtx(transform);
     xmlSecAssert2(ctx != NULL, -1);
 
     cur = xmlSecGetNextElementNode(node->children); 
     if((cur != NULL) && xmlSecCheckNodeName(cur, xmlSecNodeHMACOutputLength, xmlSecDSigNs)) {  
 	xmlChar *content;
 	
 	content = xmlNodeGetContent(cur);
 	if(content != NULL) {
 	    ctx->dgstSize = atoi((char*)content);	    
 	    xmlFree(content);
 	}
-	/* todo: error if dgstSize == 0 ?*/
+
+	/* Ensure that HMAC length is greater than min specified.
+	   Otherwise, an attacker can set this lenght to 0 or very 
+	   small value
+	*/
+	if(ctx->dgstSize < xmlSecNssHmacGetMinOutputLength()) {
+ 	   xmlSecError(XMLSEC_ERRORS_HERE,
+		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
+		    xmlSecNodeHMACOutputLength,
+		    XMLSEC_ERRORS_R_INVALID_NODE_ATTRIBUTE,
+		    "HMAC output length is too small");
+	   return(-1);
+	}
+
 	cur = xmlSecGetNextElementNode(cur->next);
     }
     
     if(cur != NULL) {
 	xmlSecError(XMLSEC_ERRORS_HERE,
 		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
 		    xmlSecNodeGetName(cur),
 		    XMLSEC_ERRORS_R_INVALID_NODE,
 		    "no nodes expected");
 	return(-1);
     }
     return(0); 
 }
 
 
diff --git a/src/openssl/hmac.c b/src/openssl/hmac.c
index 492663b..76fca0e 100644
--- a/src/openssl/hmac.c
+++ b/src/openssl/hmac.c
@@ -1,40 +1,70 @@
 /** 
  *
  * XMLSec library
  * 
  * HMAC Algorithm support (http://www.w3.org/TR/xmldsig-core/#sec-HMAC):
  * The HMAC algorithm (RFC2104 [HMAC]) takes the truncation length in bits 
  * as a parameter; if the parameter is not specified then all the bits of the 
  * hash are output. An example of an HMAC SignatureMethod element:  
  * <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#hmac-sha1">
  *   <HMACOutputLength>128</HMACOutputLength>
  * </SignatureMethod>
  * 
  * This is free software; see Copyright file in the source
  * distribution for preciese wording.
  * 
  * Copyright (C) 2002-2003 Aleksey Sanin <aleksey@aleksey.com>
  */
 #ifndef XMLSEC_NO_HMAC
 #include "globals.h"
 
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
 
 #include <openssl/hmac.h>
 
 #include <xmlsec/xmlsec.h>
 #include <xmlsec/xmltree.h>
 #include <xmlsec/keys.h>
 #include <xmlsec/transforms.h>
 #include <xmlsec/errors.h>
 
 #include <xmlsec/openssl/crypto.h>
 
+#define XMLSEC_OPENSSL_MIN_HMAC_SIZE		64
+
+/**************************************************************************
+ *
+ * Configuration
+ *
+ *****************************************************************************/
+static int g_xmlsec_openssl_hmac_min_length = XMLSEC_OPENSSL_MIN_HMAC_SIZE;
+
+/**
+ * xmlSecOpenSSLHmacGetMinOutputLength: 
+ * 
+ * Returns the min HMAC output length
+ */
+int xmlSecOpenSSLHmacGetMinOutputLength()
+{
+    return g_xmlsec_openssl_hmac_min_length;
+}
+
+/**
+ * xmlSecOpenSSLHmacSetMinOutputLength: 
+ *
+ * @min_length: the new min length 
+ * 
+ * Sets the min HMAC output length
+ */
+void xmlSecOpenSSLHmacSetMinOutputLength(int min_length)
+{
+    g_xmlsec_openssl_hmac_min_length = min_length;
+}
 
 /**************************************************************************
  *
  * Internal OpenSSL HMAC CTX
  *
  *****************************************************************************/
@@ -222,36 +252,49 @@ static int
 xmlSecOpenSSLHmacNodeRead(xmlSecTransformPtr transform, xmlNodePtr node, xmlSecTransformCtxPtr transformCtx) {
     xmlSecOpenSSLHmacCtxPtr ctx;
     xmlNodePtr cur;
 
     xmlSecAssert2(xmlSecOpenSSLHmacCheckId(transform), -1);
     xmlSecAssert2(xmlSecTransformCheckSize(transform, xmlSecOpenSSLHmacSize), -1);
     xmlSecAssert2(node!= NULL, -1);
     xmlSecAssert2(transformCtx != NULL, -1);
 
     ctx = xmlSecOpenSSLHmacGetCtx(transform);
     xmlSecAssert2(ctx != NULL, -1);
 
     cur = xmlSecGetNextElementNode(node->children); 
     if((cur != NULL) && xmlSecCheckNodeName(cur, xmlSecNodeHMACOutputLength, xmlSecDSigNs)) {  
 	xmlChar *content;
 	
 	content = xmlNodeGetContent(cur);
 	if(content != NULL) {
 	    ctx->dgstSize = atoi((char*)content);	    
 	    xmlFree(content);
 	}
-	/* todo: error if dgstSize == 0 ?*/
+
+	/* Ensure that HMAC length is greater than min specified.
+	   Otherwise, an attacker can set this lenght to 0 or very 
+	   small value
+	*/
+	if(ctx->dgstSize < xmlSecOpenSSLHmacGetMinOutputLength()) {
+ 	   xmlSecError(XMLSEC_ERRORS_HERE,
+		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
+		    xmlSecNodeHMACOutputLength,
+		    XMLSEC_ERRORS_R_INVALID_NODE_ATTRIBUTE,
+		    "HMAC output length is too small");
+	   return(-1);
+	}
+
 	cur = xmlSecGetNextElementNode(cur->next);
     }
     
     if(cur != NULL) {
 	xmlSecError(XMLSEC_ERRORS_HERE,
 		    xmlSecErrorsSafeString(xmlSecTransformGetName(transform)),
 		    xmlSecErrorsSafeString(xmlSecNodeGetName(cur)),
 		    XMLSEC_ERRORS_R_UNEXPECTED_NODE,
 		    XMLSEC_ERRORS_NO_MESSAGE);
 	return(-1);
     }
     return(0); 
 }
 
